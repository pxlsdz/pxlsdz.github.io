<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pxlsdz.github.io","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="MFC-QQ采用MFC和套接字实现简单QQ">
<meta property="og:type" content="article">
<meta property="og:title" content="MFC-QQ">
<meta property="og:url" content="https://pxlsdz.github.io/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/index.html">
<meta property="og:site_name" content="pxlsdz的博客">
<meta property="og:description" content="MFC-QQ采用MFC和套接字实现简单QQ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pxlsdz.github.io/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/media/706e44330d6639f153235948840f98f8.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/c253923683036556da2d3e495fefcafc.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/57d2e8b6db347d8d7479f8d8b5441a4c.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/d40df7ecce44210a71ac918a4ffd5548.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/d7e8fff8c25ca40ed75205550068bda9.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/c253923683036556da2d3e495fefcafc.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/709afca1b7ea30403a667bdac2a4e59c.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/cae1561faf6c5e848f0c04e6d3707b7f.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/30d2968defb23d517618b9f18d17e850.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/c253923683036556da2d3e495fefcafc.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/bf78f7c0df4f695e662c746a599c8c6a.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/6b1c30a284a883b95401e3b4743395a2.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/380cf96a89cb3cc6ef46dac5229cddd1.png">
<meta property="og:image" content="g:/项目/MFCQQ最终版%20-%20副本/MFC-QQ/media/5239b821389e72f85868c63b5f713ab5.png">
<meta property="article:published_time" content="2020-01-14T15:42:46.000Z">
<meta property="article:modified_time" content="2020-01-14T13:49:04.080Z">
<meta property="article:author" content="sdz">
<meta property="article:tag" content="课程设计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pxlsdz.github.io/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/media/706e44330d6639f153235948840f98f8.png">

<link rel="canonical" href="https://pxlsdz.github.io/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>MFC-QQ | pxlsdz的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">pxlsdz的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">分享，笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">36</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">15</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">65</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

  </div>
</div>

  </div>
</div>
    </header>

    

  <a href="https://github.com/pxlsdz" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pxlsdz.github.io/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="sdz">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="pxlsdz的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MFC-QQ
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-01-14 23:42:46 / 修改时间：21:49:04" itemprop="dateCreated datePublished" datetime="2020-01-14T23:42:46+08:00">2020-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">网络编程</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="MFC-QQ"><a href="#MFC-QQ" class="headerlink" title="MFC-QQ"></a>MFC-QQ</h1><p>采用MFC和套接字实现简单QQ</p>
<a id="more"></a>
<p><u>图片未来得及修改，GitHub可以正常观看</u></p>
<p>github源码地址：<a href="https://github.com/pxlsdz/MFC-QQ" target="_blank" rel="noopener">https://github.com/pxlsdz/MFC-QQ</a></p>
<p>合作者：WentongXu,dengdeng337(github账号）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>网络编程课程设计报告 二О二О年 一月 十四日</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<p><strong>课程设计的目的及要求</strong></p>
<p>主要目的是巩固网络编程技术基本知识，加深对相关概念和原理的理解，提高综合应用所学知识开发较为实用的网络应用程序的能力。通过一个较为综合的网络应用程序的开发训练，加深学生对网络通信程序开发的基本方法、基本技术和基本概念以及相关原理的理解，同时进一步提高学生编写较为复杂应用程序的能力，为学生将来从事实际应用开发打下坚实的理论和实践基础。</p>
<p>要求第17周一周时间内集中在网络中心的指定机房内完成，逾期实在不能完成的可延期一周利用业余时间完成。结束后在规定时间前需提交：</p>
<p>1、课程设计报告。</p>
<p>2、所开发程序的源代码，要求程序能编译运行，且功能符合基本要求。</p>
<p><strong>课程设计内容</strong></p>
<p>利用所学的网络编程技术，独立完成一个较为复杂的实用型的网络应用程序的设计开发。可从以下各题中选择一个完成：</p>
<p>1、编写一个图形界面的网络嗅探软件，界面模仿WireShark，协议分析层次包括网络层、传输层、应用层（能识别出DNS、FTP和WEB等几种常见应用则可）。</p>
<p>2、模仿QQ完成一套即时通信软件。要求：①包含一个客户软件和一个服务器软件；服务器软件负责客户的注册、登陆、在线客户管理等；客户软件包含注册、登录、根据服务器返回的在线客户信息与在线的其他客户进行聊天等功能；②客户软件工作在P2P模式，所有客户均试运行同一个软件的不同副本，两个客户软件的聊天信息是直接发送给对方的，不能经由服务器转发；③客户软件和服务器软件均采用图形界面。</p>
<p>3、自选题目，满足：基于WinSock编程、功能实用且程序较为复杂。</p>
<h1 id="课程设计题目的选择"><a href="#课程设计题目的选择" class="headerlink" title="课程设计题目的选择"></a>课程设计题目的选择</h1><p>根据题目的要求以及实习时间，结合了三个人的个人能力，决定各取所需，发挥个人的优势，我们选择了比较有挑战性的题目：模仿<br>QQ 完成一套即时通信软件作为我们本次课设的目标。</p>
<h1 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h1><h2 id="2-1设计的背景"><a href="#2-1设计的背景" class="headerlink" title="2.1设计的背景"></a>2.1设计的背景</h2><p>计算机网络技术发展至今已经大大超越了人们当初的预想，无论是人们日常的工作还是学习，我们都越来越多的依靠到互联网。各种实时性的聊天娱乐软件也同时诞生，而且为我们的即时通讯带来了众多的方便，比如说大家所熟知的腾讯QQ、微软的MSN、移动的Fetion等，都是做的比较成功的实时聊天工具。随着网络的日益普及，各种聊天工具也层出不穷，但当我们学习了《windows网络编程》这门课程之后，我们便会觉得，其实要实现简单的网络通讯其实并不难。接下来的课程设计就是针对一个简单的网络聊天程序，利用MFC为开发工具，实现基本的通讯功能。</p>
<h2 id="2-2设计的原理"><a href="#2-2设计的原理" class="headerlink" title="2.2设计的原理"></a>2.2设计的原理</h2><p>此程序主要分为两部分：服务器端和客户端。服务器端用于提供一个网络端口，等待客户端发出请求，登录到此服务端，然后进行网络通讯和消息的转发；客户端可通过服务器端的IP地址发送连接请求，然后登陆聊天室。在服务器端的成员列表栏中会显示在线的所有人名单，有人退出聊天室，成员列表会自动除名。服务器端同时也提供了成员之间的私聊功能，此时服务器端作为一个转发站，进行消息的转发。</p>
<h2 id="2-3设计思路"><a href="#2-3设计思路" class="headerlink" title="2.3设计思路"></a>2.3设计思路</h2><p>服务端利用TCP保持服务器连接，UDP模拟QQ的P2P通信，</p>
<p>一些开始时候的准备工作：</p>
<p>我们用的是select模型中FD_sock管理这些套接字</p>
<p>我们的用户信息是在一个user.txt中存储的，所以一开始需要导入进来</p>
<p>之后我们就又设计的客户端，进行登陆、注册、聊天等功能。</p>
<h2 id="2-4设计的功能要求"><a href="#2-4设计的功能要求" class="headerlink" title="2.4设计的功能要求"></a>2.4设计的功能要求</h2><p>客户端：</p>
<blockquote>
<p>  QQ登陆页面主要包含：登陆账号、登陆密码、注册、设置</p>
<p>  注册页面：注册的账号、密码（账号不允许重复）</p>
</blockquote>
<p>服务端：</p>
<blockquote>
<p>  用TCP保持服务器连接，UDP模拟QQ的P2P通信</p>
</blockquote>
<h2 id="2-5运行环境"><a href="#2-5运行环境" class="headerlink" title="2.5运行环境"></a>2.5运行环境</h2><p>本系统运正常行的硬件环境需求如下：</p>
<p>标准Windows10 系统PC一台;</p>
<p>软件支持：Visual Studio 2017</p>
<h1 id="概要设计"><a href="#概要设计" class="headerlink" title="概要设计"></a>概要设计</h1><h2 id="3-1系统结构"><a href="#3-1系统结构" class="headerlink" title="3.1系统结构"></a>3.1系统结构</h2><ol>
<li>服务端</li>
</ol>
<blockquote>
<p>  通过套接字、TCP、UDP等，完成的字符界面的服务器，连接服务器端与客户端。</p>
</blockquote>
<ol>
<li>客户端</li>
</ol>
<blockquote>
<p>  基于MFC窗口的客户端，具有登录、注册、聊天等功能。</p>
</blockquote>
<h2 id="3-2程序流程图"><a href="#3-2程序流程图" class="headerlink" title="3.2程序流程图"></a>3.2程序流程图</h2><p><img src="media/706e44330d6639f153235948840f98f8.png" alt="未命名文件(G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/706e44330d6639f153235948840f98f8.png)"></p>
<h1 id="4详细设计与实现"><a href="#4详细设计与实现" class="headerlink" title="4详细设计与实现"></a>4详细设计与实现</h1><h2 id="4-1TCP作用"><a href="#4-1TCP作用" class="headerlink" title="4.1TCP作用"></a>4.1TCP作用</h2><p>TCP是用来在服务器和客户端之间通信的</p>
<p>链接会保持，客户端的登陆退出，注册和请求另一个人的IP都是通过TCP套接字</p>
<h2 id="4-2UDP的作用"><a href="#4-2UDP的作用" class="headerlink" title="4.2UDP的作用"></a>4.2UDP的作用</h2><p>UDP是用来模拟实现P2P客户端与客户端之间通讯的，中间服务器起任何作用。</p>
<h2 id="4-3传递的消息类型"><a href="#4-3传递的消息类型" class="headerlink" title="4.3传递的消息类型"></a>4.3传递的消息类型</h2><h3 id="4-3-1客户端与服务器之间传递的消息"><a href="#4-3-1客户端与服务器之间传递的消息" class="headerlink" title="4.3.1客户端与服务器之间传递的消息"></a>4.3.1客户端与服务器之间传递的消息</h3><p>struct UserInfo</p>
<p>{</p>
<p>int op;</p>
<p>char name[maxn], pwd[maxn];</p>
<p>char ip[maxn];</p>
<p>char online[50][maxn];</p>
<p>char remsg[maxn];</p>
<p>int listlen;</p>
<p>void getonline()</p>
<p>{</p>
<p>memset(online, ‘\\0’, sizeof(online));</p>
<p>for (int i = 0; i \&lt; userip.size(); i++)</p>
<p>{</p>
<p>strcpy(online[i], onlinelist[i]);</p>
<p>}</p>
<p>}</p>
<p>};</p>
<h4 id="4-3-1-1Op"><a href="#4-3-1-1Op" class="headerlink" title="4.3.1.1Op"></a>4.3.1.1Op</h4><p>Op的作用是区分当前的消息是什么类型的消息或者是这个消息要传递到什么地方的</p>
<h4 id="4-3-1-2Name-pwd"><a href="#4-3-1-2Name-pwd" class="headerlink" title="4.3.1.2Name pwd"></a>4.3.1.2Name pwd</h4><p>登陆或者是注册时候的账号和密码信息</p>
<h4 id="4-3-1-3Ip"><a href="#4-3-1-3Ip" class="headerlink" title="4.3.1.3Ip"></a>4.3.1.3Ip</h4><p>客户端请求其他客户端ip地址时 返回的ip</p>
<h4 id="4-3-1-4Onlinelist-listlen"><a href="#4-3-1-4Onlinelist-listlen" class="headerlink" title="4.3.1.4Onlinelist listlen"></a>4.3.1.4Onlinelist listlen</h4><p>在线用户的列表 和 在线用户的数量</p>
<h4 id="4-3-1-5Remsg"><a href="#4-3-1-5Remsg" class="headerlink" title="4.3.1.5Remsg"></a>4.3.1.5Remsg</h4><p>结构体携带的消息</p>
<h4 id="4-3-1-6Void-getonline（）"><a href="#4-3-1-6Void-getonline（）" class="headerlink" title="4.3.1.6Void getonline（）"></a>4.3.1.6Void getonline（）</h4><p>在服务器端获取在线的用户</p>
<h3 id="4-3-2客户端与客户端之间传递的消息"><a href="#4-3-2客户端与客户端之间传递的消息" class="headerlink" title="4.3.2客户端与客户端之间传递的消息"></a>4.3.2客户端与客户端之间传递的消息</h3><p>struct ChatMsg</p>
<p>{</p>
<p>int op;</p>
<p>short port;</p>
<p>char username[100];</p>
<p>char msg[1000];</p>
<p>};</p>
<h4 id="①Op"><a href="#①Op" class="headerlink" title="①Op"></a>①Op</h4><p>当前消息的作用（后续会提到）</p>
<h4 id="②Port"><a href="#②Port" class="headerlink" title="②Port"></a>②Port</h4><p>对方的端口号</p>
<h4 id="③Username-msg"><a href="#③Username-msg" class="headerlink" title="③Username msg"></a>③Username msg</h4><p>自己的用户名和自己要发给对方的消息</p>
<h2 id="4-4注册消息模块"><a href="#4-4注册消息模块" class="headerlink" title="4.4注册消息模块"></a>4.4注册消息模块</h2><h3 id="4-4-1注册消息模块"><a href="#4-4-1注册消息模块" class="headerlink" title="4.4.1注册消息模块"></a>4.4.1注册消息模块</h3><h4 id="①Ip地址问题"><a href="#①Ip地址问题" class="headerlink" title="①Ip地址问题"></a>①Ip地址问题</h4><p>当我们在登陆页面上写好了IP地址时候，那么这个IP地址会传递到注册页面上面，</p>
<h4 id="②注册时候"><a href="#②注册时候" class="headerlink" title="②注册时候"></a>②注册时候</h4><p>发送一个op为2的消息到服务器端，服务器端会根据当前保存的用户列表中是否存在相同的用户名来确定是否返回的消息<br>‘注册成功’ or ‘注册失败’.</p>
<p>消息发送给服务器端的监听套接字</p>
<h3 id="4-4-2登陆模块"><a href="#4-4-2登陆模块" class="headerlink" title="4.4.2登陆模块"></a>4.4.2登陆模块</h3><h4 id="4-4-2-1IP地址和端口号"><a href="#4-4-2-1IP地址和端口号" class="headerlink" title="4.4.2.1IP地址和端口号"></a>4.4.2.1IP地址和端口号</h4><p>Ip地址需要自己填写服务器的IP地址，因为我们每次登陆校园网或者是其他局域网络时都会改变</p>
<p>端口号是不需要填写的，因为我们已经制定好了</p>
<h4 id="4-4-2-2发送登陆和返回的消息"><a href="#4-4-2-2发送登陆和返回的消息" class="headerlink" title="4.4.2.2发送登陆和返回的消息"></a>4.4.2.2发送登陆和返回的消息</h4><h6 id="①发送登陆消息时候-op-1"><a href="#①发送登陆消息时候-op-1" class="headerlink" title="①发送登陆消息时候 op=1"></a>①发送登陆消息时候 op=1</h6><p>服务器端会判断是不是密码正确返回登陆成功or失败</p>
<h6 id="②服务器端返回的消息op-1"><a href="#②服务器端返回的消息op-1" class="headerlink" title="②服务器端返回的消息op=1"></a>②服务器端返回的消息op=1</h6><p>如果登陆成功会打开我们的list主列表模块并将与服务器端保持通讯的套接字传递过去</p>
<p>关键代码如下：if (userop == 1) //当前是登陆信息</p>
<p>{</p>
<p>string name = userinfo.name, pwd = userinfo.pwd;</p>
<p>UserInfo reinfo;</p>
<p>strcpy(reinfo.name , userinfo.name);</p>
<p>reinfo.op = 1;</p>
<p>memset(reinfo.remsg, 0, sizeof(reinfo.remsg));</p>
<p>if (userlog[name] == pwd)</p>
<p>{</p>
<p>char yes[10] = “yes”;</p>
<p>cout \&lt;\&lt; “用户：” \&lt;\&lt; name \&lt;\&lt; “ 登陆成功！” \&lt;\&lt; endl;</p>
<p>strcpy(reinfo.remsg, yes);</p>
<p>cout \&lt;\&lt; “回复消息：”\&lt;\&lt;reinfo.remsg \&lt;\&lt; endl;</p>
<p>userip[name] = inet_ntoa(client_addr.sin_addr);</p>
<p>/*****************************************************/</p>
<p>struct sockaddr_in sa;</p>
<p>if (!getpeername(newsock, (struct sockaddr *)&amp;sa, &amp;len))</p>
<p>{</p>
<p>printf(“对方IP：%s “, inet_ntoa(sa.sin_addr));</p>
<p>printf(“对方PORT：%d “, ntohs(sa.sin_port));</p>
<p>}</p>
<p>/******************************************************/</p>
<p>onlineupdate();</p>
<p>showuserlist();</p>
<p>reinfo.getonline();</p>
<p>// ***************************发送登陆成功信息</p>
<p>if ((size = send(newsock, (char *)&amp;reinfo, sizeof(reinfo), 0)) \&lt; 0)</p>
<p>cout \&lt;\&lt; “发送信息失败！错误代码:” \&lt;\&lt; WSAGetLastError() \&lt;\&lt; endl;</p>
<p>else if (size == 0)</p>
<p>cout \&lt;\&lt; “对方已关闭连接！\\n”;</p>
<p>//******************************************</p>
<p>cout \&lt;\&lt; “fd size:” \&lt;\&lt; fdsock.fd_count \&lt;\&lt; endl;</p>
<p>reinfo.op = 4;//回复消息;</p>
<p>for (int j = 0; j \&lt; fdsock.fd_count; j++)</p>
<p>{</p>
<p>if (fdsock.fd_array[j] != sock_server &amp;&amp; j != i)</p>
<p>send(fdsock.fd_array[j], (char *)&amp;reinfo, sizeof(reinfo), 0);</p>
<p>}</p>
<p>FD_SET(newsock, \&amp;fdsock);</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>strcpy(reinfo.remsg, “no”);</p>
<p>if ((size = send(newsock, (char *)&amp;reinfo, sizeof(reinfo), 0)) \&lt; 0)</p>
<p>cout \&lt;\&lt; “发送信息失败！错误代码:” \&lt;\&lt; WSAGetLastError() \&lt;\&lt; endl;</p>
<p>else if (size == 0)</p>
<p>cout \&lt;\&lt; “对方已关闭连接！\\n”;</p>
<p>closesocket(newsock);</p>
<p>}</p>
<p>}</p>
<h2 id="4-5List主列表模块"><a href="#4-5List主列表模块" class="headerlink" title="4.5List主列表模块"></a>4.5List主列表模块</h2><p>这个模块中有我们的在线用户的列表</p>
<p>关键代码：</p>
<p>void onlineupdate()</p>
<p>{</p>
<p>int i = 0;</p>
<p>iter = userip.begin();</p>
<p>len = 0;</p>
<p>while (iter != userip.end()) {</p>
<p>if (iter->second == “”)</p>
<p>{</p>
<p>iter++;</p>
<p>continue;</p>
<p>}</p>
<p>len++;</p>
<p>strcpy(onlinelist[i],zhuan(iter->first.data()));</p>
<p>cout \&lt;\&lt; “用户名：” \&lt;\&lt; iter->first \&lt;\&lt;” IP地址：”\&lt;\<iter-\>second\&lt;\&lt;<br>endl;</p>
<p>iter++;</p>
<p>i++;</p>
<p>}</p>
<p>cout \&lt;\&lt; “在线用户列表更新完成！” \&lt;\&lt; endl;</p>
<p>}</p>
<p><strong>①开启list时</strong></p>
<p>当我们登陆成功时，我们会打开list模块</p>
<p>这时，在一开始的oninit函数中会创建 用于监听有客户端想与我通信的消息</p>
<p>还会一开始导入一个onlinelist在线用户的列表（后续会更新）</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/c253923683036556da2d3e495fefcafc.png" alt=""></p>
<p><strong>②List的维护</strong></p>
<p>主要是维护在线的列表。</p>
<p>有这样几个维护的时机 用户登陆，用户退出</p>
<p><strong>③用户登陆</strong></p>
<p>如果有某个用户登陆的时候<br>服务器发送一个op=4的消息给我们的TCP套接字，用来刷新在线的用户。</p>
<p><strong>④用户退出</strong></p>
<p>点击退出按钮的时候会先发送一个op=3的消息给服务器端，</p>
<p>这时候服务器端维护在线用户列表</p>
<p>当某个客户端的发送的消息size=0的时候说明链接已经断开，那么这时候我么广播一下这个用户列表</p>
<p>在FD_sock中删除</p>
<h2 id="4-6在线用户列表的操作"><a href="#4-6在线用户列表的操作" class="headerlink" title="4.6在线用户列表的操作"></a>4.6在线用户列表的操作</h2><p><strong>①双击某个用户</strong></p>
<p>当我们双击某个用户的时候这时候就会执行双击事件，执行的代码是我们想服务器端发送一个op=4的消息用于请求用户名对应的IP地址</p>
<p>先创建一个chat模块用户和对面通信，在打开的时候我们会申请一个端口号用于创建一个回话UDP套接字与对面通讯</p>
<p>然后发送一个消息给我们请求到的IP地址，这时候UDP套接字起到作用，其中一开始的用于监听的UDP套接字的端口号是固定的</p>
<p><strong>②List中的UDP套接字的作用</strong></p>
<p>当我们收到一个消息的时候，首先我们可以确定这个消息是有人想和我们通讯，</p>
<p>这时候我们打开一个chat模块，用于和用户通讯，chat模块可以多次打开</p>
<p>当我们打开一个chat模块的时候，会创建一个UDP套接字，对应的端口号会放在一个vector中，用一个find函数来找到我们还没有用过的端口号，</p>
<p>准备好了自身的端口号之后立刻向对方发送一个op=0的消息，</p>
<p>此时对方也就指的是他给我发送消息的端口号和IP地址</p>
<p>告诉对面我的端口号是XXX 之后我们就可以自由的通信了</p>
<h2 id="4-7Chat模块"><a href="#4-7Chat模块" class="headerlink" title="4.7Chat模块"></a>4.7Chat模块</h2><p>此时我们基本上已经把所有的p2p的准备工作做完，直接开始通信即可</p>
<h2 id="4-8服务器端"><a href="#4-8服务器端" class="headerlink" title="4.8服务器端"></a>4.8服务器端</h2><h3 id="①一些开始时候的准备工作"><a href="#①一些开始时候的准备工作" class="headerlink" title="①一些开始时候的准备工作"></a>①一些开始时候的准备工作</h3><p>我们用的是select模型中FD_sock管理这些套接字</p>
<p>我们的用户信息是在一个user.txt中存储的，所以一开始需要导入进来</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/57d2e8b6db347d8d7479f8d8b5441a4c.png" alt=""></p>
<p>当我们导入完成的时候，就可以开始创建监听套接字并开始我们的工作了</p>
<p>关键代码如下：</p>
<p>void jieshu()</p>
<p>{</p>
<p>char name[maxn], pwd[maxn];</p>
<p>ofstream writeFile(“D://user.txt”);</p>
<p>iter = userlog.begin();</p>
<p>while (iter != userlog.end()) {</p>
<p>//cout \&lt;\&lt; iter->first \&lt;\&lt; “ : “ \&lt;\&lt; iter->second \&lt;\&lt; endl;</p>
<p>strcpy(name ,zhuan(iter->first)), strcpy(pwd ,zhuan(iter->second));</p>
<p>writeFile \&lt;\&lt; name \&lt;\&lt; “ “ \&lt;\&lt; pwd \&lt;\&lt; endl;</p>
<p>iter++;</p>
<p>}</p>
<p>cout \&lt;\&lt; “用户数据保存成功！” \&lt;\&lt; endl;</p>
<p>}</p>
<p>void init()</p>
<p>{</p>
<p>ifstream readFile(“D://user.txt”);</p>
<p>char temp[1024] = { 0 };</p>
<p>char name[maxn], pwd[maxn];</p>
<p>//char a[10000], b[10000];</p>
<p>while (readFile >>name >> pwd)</p>
<p>{</p>
<p>userlog[name] = pwd;</p>
<p>cout \&lt;\&lt; name \&lt;\&lt; “ “ \&lt;\&lt; pwd \&lt;\&lt; endl;</p>
<p>}</p>
<p>cout \&lt;\&lt; “用户数据导入成功！” \&lt;\&lt; endl;</p>
<p>}</p>
<h3 id="②op-1-接收登陆信息"><a href="#②op-1-接收登陆信息" class="headerlink" title="②op =1 接收登陆信息"></a>②op =1 接收登陆信息</h3><p>接受到登陆信息的时候我们判断user列表里面的用户名和密码是不是对得上</p>
<p>如果可以就发送一个yes的op=1的消息回去告诉客户端</p>
<p>并添加这个用户到onlinelist中</p>
<p>并转发op=4的消息广播到其他用户让他们更新在线列表</p>
<p>此时套接字发送完毕套接字保存在FD_sock 中</p>
<h3 id="③op-2-接收注册信息"><a href="#③op-2-接收注册信息" class="headerlink" title="③op =2 接收注册信息"></a>③op =2 接收注册信息</h3><p>判断是不是用户名重复不重复就是注册成功</p>
<p>更新user列表，并调用写会user.txt函数保存下来</p>
<p>返回一个op=2的消息，告诉客户端是不是注册成功</p>
<p>此时套接字发送完毕直接断开连接</p>
<h3 id="④op-3-接收注销信息"><a href="#④op-3-接收注销信息" class="headerlink" title="④op =3 接收注销信息"></a>④op =3 接收注销信息</h3><p>此时我们在onlinelist中去除掉携带的username 套接字不会在现在断开</p>
<h3 id="⑤op-4-接收用户请求ip信息"><a href="#⑤op-4-接收用户请求ip信息" class="headerlink" title="⑤op =4 接收用户请求ip信息"></a>⑤op =4 接收用户请求ip信息</h3><p>返回一个op=5的消息告诉他请求的那个用户的IP地址</p>
<h3 id="⑥接收到size-lt-0的消息"><a href="#⑥接收到size-lt-0的消息" class="headerlink" title="⑥接收到size\&lt;=0的消息"></a>⑥接收到size\&lt;=0的消息</h3><p>说明有用户退出了，这时候我们的在线用户列表在上次通讯的时候挤一挤创新完成，</p>
<p>这时候我们只需要先广播一个op=4的消息，并吧当前套接字在FD_sock中去除就可以了</p>
<h1 id="5-系统整体说明书"><a href="#5-系统整体说明书" class="headerlink" title="5.系统整体说明书"></a>5.系统整体说明书</h1><h2 id="5-1登陆界面"><a href="#5-1登陆界面" class="headerlink" title="5.1登陆界面"></a>5.1登陆界面</h2><p>我们仿照了QQ的登陆页面，有隐藏设置的选项，隐藏设置的端口号以及服务器端IP。</p>
<p>这里我们采用的默认IP地址127.0.0.1以及默认的端口号。</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/d40df7ecce44210a71ac918a4ffd5548.png" alt=""></p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/d7e8fff8c25ca40ed75205550068bda9.png" alt=""></p>
<p>服务器端：</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/c253923683036556da2d3e495fefcafc.png" alt=""></p>
<h2 id="5-2注册界面"><a href="#5-2注册界面" class="headerlink" title="5.2注册界面"></a>5.2注册界面</h2><p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/709afca1b7ea30403a667bdac2a4e59c.png" alt=""></p>
<p>服务器端：</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/cae1561faf6c5e848f0c04e6d3707b7f.png" alt=""></p>
<h2 id="5-3好友列表界面"><a href="#5-3好友列表界面" class="headerlink" title="5.3好友列表界面"></a>5.3好友列表界面</h2><p>可以显示用户名以及在线好友列表，最小化、退出的功能。每个用户登陆时，都会更新好友列表。</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/30d2968defb23d517618b9f18d17e850.png" alt=""></p>
<p>服务器端：</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/c253923683036556da2d3e495fefcafc.png" alt=""></p>
<h2 id="5-4聊天界面"><a href="#5-4聊天界面" class="headerlink" title="5.4聊天界面"></a>5.4聊天界面</h2><p>两个在线好友之间可以实现端到端的通信。</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/bf78f7c0df4f695e662c746a599c8c6a.png" alt=""></p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/6b1c30a284a883b95401e3b4743395a2.png" alt=""></p>
<p>服务器端：</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/380cf96a89cb3cc6ef46dac5229cddd1.png" alt=""></p>
<h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6.总结"></a>6.总结</h1><h2 id="6-1遇到的问题及不足"><a href="#6-1遇到的问题及不足" class="headerlink" title="6.1遇到的问题及不足"></a>6.1遇到的问题及不足</h2><h3 id="6-1-1遇到的问题"><a href="#6-1-1遇到的问题" class="headerlink" title="6.1.1遇到的问题"></a>6.1.1遇到的问题</h3><p>①问题：登陆的时候，在自己的电脑登陆成功，将代码完全拷贝到别人的电脑上，但登陆不成功，但在服务器端显示均为登陆成功？</p>
<p>问题分析与解决：在调试代码的时候，调用MessageBox()函数的时候在功能函数代码顶部加上莫名的登陆成功，后来，经指导教师指导，得知可能客户端还没来得及接受的服务器发来的消息，就执行if判断，导致客户端登陆不成功，调用Sleep()函数完美解决。</p>
<p>②问题：实现端对端的通信的时候，一开始图省事，想就用一个套接字解决端的端通信，即使用朋友列表对话框的套接字接受到消息，然后根据消息的用户名来放到相应的聊天对话框当中，不符实际（效率低下）且实现困难。</p>
<p>解决：实现苦难的原因，domodel（）函数不了解，使用过后会注销这个窗口，所有有消息来得到时候，我们调用ListBox函数控件的addString（）函数是不起作用的。我们改用CreatWindow()函数，但不知道为什么某名的出现闪现，于是，我们推翻了思路，重现采用一个聊天窗口一个套接字的思想，实现了可以多个窗口同时聊天的通信功能。</p>
<p>③问题：控件中的内容不能及时显示？</p>
<p>解决：及时调用UpdateData(TRUE)和UpdateData(FALSE)</p>
<h3 id="6-1-2不足"><a href="#6-1-2不足" class="headerlink" title="6.1.2不足"></a>6.1.2不足</h3><p>①因时间原因，我们只实现了部分的功能，还有很多可以尝试的功能未实现，例如：头像、聊天时的文件传输、发送表情或者图片，登陆时的记住密码、忘记密码以及自动登录的功能。</p>
<p>②界面设计较为仓促，没能较为精致的设计界面，服务器端也直接采用了字符型界面，未完成、采用MFC界面设计。</p>
<p>③因异步消息或者越界原因，本项目存在着一个问题，但是因为时间以及技术问题，还未能解决。在多个处理中，经常会弹出此页面。</p>
<p><img src="G:/项目/MFCQQ最终版 - 副本/MFC-QQ/media/5239b821389e72f85868c63b5f713ab5.png" alt=""></p>
<p>④当出现问题时，比如注册失败出现异常，程序会陷入漫长的没有反应的状况。没有加异常处理。</p>
<p>⑤成员列表在非正常退出时，服务器端得不到及时而有效地更新；</p>
<p>⑥用户登录前必须先知道服务器端的IP，这样操作显然比较麻烦；</p>
<p>⑦聊天记录和好友列表的缓存机制待实现</p>
<p>⑧只采用了较简单的select()模型（服务器端）和异步套接字模型（客户端），在实际运用中存在效率问题。</p>
<h2 id="6-2个人总结"><a href="#6-2个人总结" class="headerlink" title="6.2个人总结"></a>6.2个人总结</h2><p>本次课程设计选了一个相对自己来说较难的，从霖开始一步步实现，确实有点费劲，有许多是自己考虑不到，比如，上面的不足的③和那个sleep()函数的添加，当时是卡了自己很久的错误。做这个的同时也体会到他是很有意思的，平常经常使用的QQ是有很多很多道道的，我们的项目比较简单只采用了较简单的select()模型（服务器端）和异步套接字模型（客户端），在实际运用中有这么多客户连接，同时发送和接受，腾讯是如何做到的效率很高的。还有就是其中的缓存机制，QQ好友列表的缓存机制是如何做到本体和服务器同步，尤其对消息对的缓存机制，QQ的服务器看来还是很强大的。本次实现的最大的困难就是实现多个对话窗口的聊天，端口如何高效的分配，这个应该和算法相关，我初步设想的是给定一个特定区间[l,r]的数，然后模拟并查集+字典就可实现删除和查找第一个可用的数即可，但这个算法的问题是不利于回收。还用明白了为啥要三次握手。总之，一步步实现对自己的收获还是很大的，以后需要多做项目，才能深刻的理解知识点和编程技巧，有机会还需要继续完善这个项目。</p>
<h1 id="7-附录"><a href="#7-附录" class="headerlink" title="7.附录"></a>7.附录</h1><h2 id="7-1ping程序原理"><a href="#7-1ping程序原理" class="headerlink" title="7.1ping程序原理"></a>7.1ping程序原理</h2><p>ping是通过ICMP协议实现的。Ping程序发送ICMP回送请求消息给目的主机，ICMP协议规定，目的主机必须返回ICMP回送应答消息给源主机。如果源主机在一定时间内收到应答，则认为主机可达。PING利用ICMP协议包来侦测另一个主机是否可达。原理是构造并发送多个类型码为8的ICMP回送请求包，其中用发送时的时间来填写时间戳字段，使用原始套接字发送给目的机器，收到ICMP回送请求包的目的主机则将收到的ICMP包用类型码改为0，重新计算校验和并替换后再封装到IP分组中发送回去作为回应。ping程序接收目的机器会送回来的ICMP回送响应包，并以此计算发送和接收之间的时间间隔，同时统计有多少个包被送达。用户依此就可以判断网络大致的情况。利用原始套接字编程可实现ping的功能，实现时需要定义好IP数据报、ICMP包等相关的数据结构。</p>
<h2 id="7-2ping程序设计大体流程"><a href="#7-2ping程序设计大体流程" class="headerlink" title="7.2ping程序设计大体流程"></a>7.2ping程序设计大体流程</h2><p>(1)从传给main函数的参数中读取目的地址</p>
<p>(2)设置套接字接收超时时间</p>
<p>(3)构造ICMP包</p>
<p>(4)计算校验和</p>
<p>(5)解析ICMP包</p>
<h2 id="7-3代码示例"><a href="#7-3代码示例" class="headerlink" title="7.3代码示例"></a>7.3代码示例</h2><p>// Ping.cpp : 定义控制台应用程序的入口点。</p>
<p>//</p>
<p>#include \<iostream\></p>
<p>#include \<winsock2.h\></p>
<p>#pragma comment(lib, “WS2_32”)</p>
<p>#define DATALEN 1012</p>
<p>#define PACKAGENUM 10 //发送ICMP会从请求报文的个数</p>
<p>using namespace std;</p>
<p>/***定义ICMP包结构***/</p>
<p>typedef struct icmp_hdr</p>
<p>{</p>
<p>unsigned char icmp_type; // ICMP包类型</p>
<p>unsigned char icmp_code; // 代码</p>
<p>unsigned short icmp_checksum; // 校验和</p>
<p>unsigned short icmp_id; // 惟一确定此请求的标识，通常设置为进程ID</p>
<p>unsigned short icmp_sequence; // 序列号</p>
<p>unsigned long icmp_timestamp; // 时间戳</p>
<p>} IcmpHeader;</p>
<p>unsigned short checksum(unsigned short* buff, int size); //校验和计算函数的声明</p>
<p>int main(int argc, char *argv[])</p>
<p>{</p>
<p>/***加载Winsock2.2***/</p>
<p>WSADATA wsaData;</p>
<p>int ret;</p>
<p>if ((ret = WSAStartup(MAKEWORD(1, 0), &amp;wsaData)) != 0)</p>
<p>{</p>
<p>cout \&lt;\&lt; “初始化WinSock2.2出错!”;</p>
<p>exit(0);</p>
<p>}</p>
<p>char szDestIp[256] = { 0 };//存放要Ping的IP地址或域名</p>
<p>//检查ping命令的使用格式是否正确，程序调试时可用后面的代码替换</p>
<p>/*if (argc \&lt; 2)</p>
<p>{</p>
<p>cout\&lt;\&lt;”\\n用法: ping IP地址|域名\\n”;</p>
<p>return -1;</p>
<p>}</p>
<p>strcpy(szDestIp,argv[1]);*/</p>
<p>/***输入对方IP地址，调试程序时使用***/</p>
<p>cout \&lt;\&lt; “请输入你要Ping的IP地址…\\n”;</p>
<p>cin.getline(szDestIp, sizeof(szDestIp));</p>
<p>/***将点分十进制IP地址转换为32位二进制表示的IP地址***/</p>
<p>unsigned long ulDestIP = inet_addr(szDestIp);</p>
<p>/****转换不成功时按域名解析****/</p>
<p>if (ulDestIP == INADDR_NONE)</p>
<p>{</p>
<p>hostent* pHostent = gethostbyname(szDestIp);</p>
<p>if (pHostent != NULL)</p>
<p>ulDestIP = (*(in_addr*)pHostent->h_addr).s_addr;</p>
<p>else //解析主机名失败</p>
<p>{</p>
<p>cout \&lt;\&lt; “域名解析失败：” \&lt;\&lt; argv[1] \&lt;\&lt; “错误码:” \&lt;\&lt; WSAGetLastError()<br>\&lt;\&lt; endl;</p>
<p>WSACleanup();</p>
<p>return -1;</p>
<p>}</p>
<p>}</p>
<p>/**** 创建收发ICMP包的原始套接字***/</p>
<p>SOCKET sRaw = socket(AF_INET, SOCK_RAW, IPPROTO_ICMP);</p>
<p>/***设置接收超时时间***/</p>
<p>int nTime = 1000;</p>
<p>ret = setsockopt(sRaw, SOL_SOCKET, SO_RCVTIMEO, (char*)&amp;nTime, sizeof(nTime));</p>
<p>if (ret == SOCKET_ERROR)</p>
<p>{</p>
<p>cout \&lt;\&lt; “套接字选项设置出错!错误码:” \&lt;\&lt; WSAGetLastError() \&lt;\&lt; endl;</p>
<p>return -1;;</p>
<p>}</p>
<p>/***设置ICMP包发送的目的地址***/</p>
<p>SOCKADDR_IN dest;</p>
<p>dest.sin_family = AF_INET;</p>
<p>dest.sin_port = htons(0);</p>
<p>dest.sin_addr.S_un.S_addr = ulDestIP;</p>
<p>/***创建ICMP包***/</p>
<p>char buff[sizeof(IcmpHeader) + DATALEN];</p>
<p>IcmpHeader* pIcmp = (IcmpHeader*)buff;</p>
<p>/***填写ICMP包数据***/</p>
<p>pIcmp->icmp_type = 8; // ICMP回送请求</p>
<p>pIcmp->icmp_code = 0;</p>
<p>pIcmp->icmp_id = (unsigned short)GetCurrentProcessId();//获取进程号作为ID</p>
<p>pIcmp->icmp_timestamp = 0; //时间戳暂设置为0，具体值发送时再填</p>
<p>pIcmp->icmp_checksum = 0; //校验和在计算前应先设置为0</p>
<p>pIcmp->icmp_sequence = 0; //初始序列号</p>
<p>/***填充数据部分，可以为任意***/</p>
<p>memset(&amp;buff[sizeof(IcmpHeader)], ‘A’, DATALEN);</p>
<p>/***调用connect()函数为原始套接字指定通信对端地址***/</p>
<p>connect(sRaw, (SOCKADDR *)&amp;dest, sizeof(dest));</p>
<p>/***收发ICMP报文***/</p>
<p>int n = 0;</p>
<p>bool bTimeout;</p>
<p>unsigned short nSeq = 0;//发送的ICMP报文的序号</p>
<p>char recvBuf[32 + DATALEN];//定义接收缓冲区</p>
<p>SOCKADDR_IN from; //保存收到的数据的源地址</p>
<p>int nLen = sizeof(from); //地址长度</p>
<p>IcmpHeader* pRecvIcmp; //指向ICMP报文首部的指针</p>
<p>while (TRUE)</p>
<p>{</p>
<p>static int nCount = 0;</p>
<p>int nRet;</p>
<p>if (nCount++ == PACKAGENUM)</p>
<p>break;</p>
<p>/***填写发送前才能填写的一些字段并发送ICMP包***/</p>
<p>pIcmp->icmp_checksum = 0;</p>
<p>pIcmp->icmp_timestamp = GetTickCount();//时间戳</p>
<p>pIcmp->icmp_sequence = nSeq++; //包序号</p>
<p>pIcmp->icmp_checksum = checksum((unsigned short*)buff, sizeof(IcmpHeader) +<br>DATALEN);</p>
<p>nRet = send(sRaw, buff, sizeof(IcmpHeader) + DATALEN, 0);</p>
<p>if (nRet == SOCKET_ERROR)</p>
<p>{</p>
<p>cout \&lt;\&lt; “发送失败!错误码:” \&lt;\&lt; WSAGetLastError() \&lt;\&lt; endl;</p>
<p>closesocket(sRaw);</p>
<p>WSACleanup();</p>
<p>return -1;</p>
<p>}</p>
<p>//接收对方返回的ICMP应答</p>
<p>bTimeout = FALSE;</p>
<p>n = 0;</p>
<p>do {</p>
<p>n++;//接收预期ICMP应答报文的尝试次数加1</p>
<p>memset((void *)recvBuf, 0, sizeof(recvBuf));</p>
<p>nRet = recvfrom(sRaw, recvBuf, sizeof(recvBuf), 0, (sockaddr*)&amp;from, \&amp;nLen);</p>
<p>if (nRet == SOCKET_ERROR)</p>
<p>{</p>
<p>if (WSAGetLastError() == WSAETIMEDOUT)</p>
<p>{</p>
<p>cout \&lt;\&lt; “ timed out!\\n”;</p>
<p>bTimeout = TRUE; //接收时间超时</p>
<p>break;</p>
<p>}</p>
<p>cout \&lt;\&lt; “接收失败!错误码:” \&lt;\&lt; WSAGetLastError() \&lt;\&lt; endl;</p>
<p>return -1;</p>
<p>}</p>
<p>pRecvIcmp = (IcmpHeader*)(recvBuf + 20);</p>
<p>//收到的数据包含20个字节的IP首部，加20才是ICMP首部位置</p>
<p>if (pRecvIcmp->icmp_id != GetCurrentProcessId())</p>
<p>//收到报文是否为本程序发送的请求报文的应答报文</p>
<p>{</p>
<p>//不是则重新接收</p>
<p>cout \&lt;\&lt; “ 收到一个非预期的ICMP报文，忽略！\\n”;</p>
<p>}</p>
<p>else //是则退出循环</p>
<p>break;</p>
<p>} while (n \&lt; 10);//重新接收次数不超过10则继续重试</p>
<p>if (n > 10)// 收到太多非预期的ICMP报文则退出</p>
<p>{</p>
<p>cout \&lt;\&lt; “对方机器向本机发送了太多的ICMP报文.\\n”;</p>
<p>closesocket(sRaw);</p>
<p>WSACleanup();</p>
<p>return -1;</p>
<p>}</p>
<p>if (bTimeout)continue; //接收超时则发送下一个ICPM报文</p>
<p>/****解析接收到的ICMP包****/</p>
<p>int nTick = GetTickCount();</p>
<p>if (nRet \&lt; 20 + sizeof(IcmpHeader)) //收到的报文长度不足则不予解析</p>
<p>{</p>
<p>cout \&lt;\&lt; “Too few bytes from” \&lt;\&lt; inet_ntoa(from.sin_addr) \&lt;\&lt; endl;</p>
<p>continue;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>//解析收到报文</p>
<p>cout \&lt;\&lt; nRet \&lt;\&lt; “ bytes from :” \&lt;\&lt; inet_ntoa(from.sin_addr);</p>
<p>cout \&lt;\&lt; “ icmp_seq = “ \&lt;\&lt; pRecvIcmp->icmp_sequence;</p>
<p>cout \&lt;\&lt; “ time:” \&lt;\&lt; nTick - pRecvIcmp->icmp_timestamp \&lt;\&lt; “ ms \\n”;</p>
<p>Sleep(1000); //延时1秒再发送下一个数据包</p>
<p>}</p>
<p>}</p>
<p>closesocket(sRaw);</p>
<p>WSACleanup();</p>
<p>return 0;</p>
<p>}</p>
<p>/*************计算校验和的函数***************/</p>
<p>unsigned short checksum(unsigned short* buff, int size)</p>
<p>{</p>
<p>unsigned long cksum = 0;</p>
<p>while (size > 1)</p>
<p>{</p>
<p>cksum += *buff++;</p>
<p>size -= sizeof(unsigned short);</p>
<p>}</p>
<p>if (size)// 是奇数</p>
<p>cksum += *(char*)buff;</p>
<p>//将32位的chsum高16位和低16位相加然后取反</p>
<p>cksum = (cksum >> 16) + (cksum &amp; 0xffff);</p>
<p>cksum += (cksum >> 16);</p>
<p>return (unsigned short)(~cksum);</p>
<p>}</p>

    </div>

    
    
    
	
    <div style="text-align:center;color: #ccc;font-size:14px;">
------------- 本文结束 <i class="fa fa-heart-o"></i> 感谢您的阅读-------------
</div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>sdz
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://pxlsdz.github.io/2020/01/14/MFC-QQ%E5%AE%9E%E7%8E%B0/" title="MFC-QQ">https://pxlsdz.github.io/2020/01/14/MFC-QQ实现/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1/" rel="tag"><i class="fa fa-tag"></i> 课程设计</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/14/%E5%90%B4%E6%81%A9%E8%BE%BE%E8%AF%BE%E5%90%8E%E7%BC%96%E7%A8%8B%E4%BD%9C%E4%B8%9A-Course-1-%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E7%AC%AC%E4%BA%8C%E5%91%A8%E4%BD%9C%E4%B8%9A-%E5%85%B7%E6%9C%89%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E6%80%9D%E7%BB%B4%E7%9A%84Logistic%E5%9B%9E%E5%BD%92/" rel="prev" title="吴恩达课后编程作业 Course 1 神经网络和深度学习 - 第二周作业 - 具有神经网络思维的Logistic回归">
      <i class="fa fa-chevron-left"></i> 吴恩达课后编程作业 Course 1 神经网络和深度学习 - 第二周作业 - 具有神经网络思维的Logistic回归
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/15/Python%E5%9F%BA%E7%A1%80%E4%B8%8ENumpy-%E5%90%B4%E6%81%A9%E8%BE%BE%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="next" title="Python基础与Numpy 吴恩达深度学习">
      Python基础与Numpy 吴恩达深度学习 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MFC-QQ"><span class="nav-number">1.</span> <span class="nav-text">MFC-QQ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#课程设计题目的选择"><span class="nav-number">2.</span> <span class="nav-text">课程设计题目的选择</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#需求分析"><span class="nav-number">3.</span> <span class="nav-text">需求分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1设计的背景"><span class="nav-number">3.1.</span> <span class="nav-text">2.1设计的背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2设计的原理"><span class="nav-number">3.2.</span> <span class="nav-text">2.2设计的原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3设计思路"><span class="nav-number">3.3.</span> <span class="nav-text">2.3设计思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4设计的功能要求"><span class="nav-number">3.4.</span> <span class="nav-text">2.4设计的功能要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5运行环境"><span class="nav-number">3.5.</span> <span class="nav-text">2.5运行环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#概要设计"><span class="nav-number">4.</span> <span class="nav-text">概要设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1系统结构"><span class="nav-number">4.1.</span> <span class="nav-text">3.1系统结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2程序流程图"><span class="nav-number">4.2.</span> <span class="nav-text">3.2程序流程图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4详细设计与实现"><span class="nav-number">5.</span> <span class="nav-text">4详细设计与实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1TCP作用"><span class="nav-number">5.1.</span> <span class="nav-text">4.1TCP作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2UDP的作用"><span class="nav-number">5.2.</span> <span class="nav-text">4.2UDP的作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3传递的消息类型"><span class="nav-number">5.3.</span> <span class="nav-text">4.3传递的消息类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1客户端与服务器之间传递的消息"><span class="nav-number">5.3.1.</span> <span class="nav-text">4.3.1客户端与服务器之间传递的消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-1Op"><span class="nav-number">5.3.1.1.</span> <span class="nav-text">4.3.1.1Op</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-2Name-pwd"><span class="nav-number">5.3.1.2.</span> <span class="nav-text">4.3.1.2Name pwd</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-3Ip"><span class="nav-number">5.3.1.3.</span> <span class="nav-text">4.3.1.3Ip</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-4Onlinelist-listlen"><span class="nav-number">5.3.1.4.</span> <span class="nav-text">4.3.1.4Onlinelist listlen</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-5Remsg"><span class="nav-number">5.3.1.5.</span> <span class="nav-text">4.3.1.5Remsg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-6Void-getonline（）"><span class="nav-number">5.3.1.6.</span> <span class="nav-text">4.3.1.6Void getonline（）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2客户端与客户端之间传递的消息"><span class="nav-number">5.3.2.</span> <span class="nav-text">4.3.2客户端与客户端之间传递的消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#①Op"><span class="nav-number">5.3.2.1.</span> <span class="nav-text">①Op</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#②Port"><span class="nav-number">5.3.2.2.</span> <span class="nav-text">②Port</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#③Username-msg"><span class="nav-number">5.3.2.3.</span> <span class="nav-text">③Username msg</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4注册消息模块"><span class="nav-number">5.4.</span> <span class="nav-text">4.4注册消息模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1注册消息模块"><span class="nav-number">5.4.1.</span> <span class="nav-text">4.4.1注册消息模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#①Ip地址问题"><span class="nav-number">5.4.1.1.</span> <span class="nav-text">①Ip地址问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#②注册时候"><span class="nav-number">5.4.1.2.</span> <span class="nav-text">②注册时候</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2登陆模块"><span class="nav-number">5.4.2.</span> <span class="nav-text">4.4.2登陆模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-1IP地址和端口号"><span class="nav-number">5.4.2.1.</span> <span class="nav-text">4.4.2.1IP地址和端口号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-2发送登陆和返回的消息"><span class="nav-number">5.4.2.2.</span> <span class="nav-text">4.4.2.2发送登陆和返回的消息</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#①发送登陆消息时候-op-1"><span class="nav-number">5.4.2.2.0.1.</span> <span class="nav-text">①发送登陆消息时候 op&#x3D;1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#②服务器端返回的消息op-1"><span class="nav-number">5.4.2.2.0.2.</span> <span class="nav-text">②服务器端返回的消息op&#x3D;1</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5List主列表模块"><span class="nav-number">5.5.</span> <span class="nav-text">4.5List主列表模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6在线用户列表的操作"><span class="nav-number">5.6.</span> <span class="nav-text">4.6在线用户列表的操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-7Chat模块"><span class="nav-number">5.7.</span> <span class="nav-text">4.7Chat模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-8服务器端"><span class="nav-number">5.8.</span> <span class="nav-text">4.8服务器端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#①一些开始时候的准备工作"><span class="nav-number">5.8.1.</span> <span class="nav-text">①一些开始时候的准备工作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#②op-1-接收登陆信息"><span class="nav-number">5.8.2.</span> <span class="nav-text">②op &#x3D;1 接收登陆信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#③op-2-接收注册信息"><span class="nav-number">5.8.3.</span> <span class="nav-text">③op &#x3D;2 接收注册信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#④op-3-接收注销信息"><span class="nav-number">5.8.4.</span> <span class="nav-text">④op &#x3D;3 接收注销信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#⑤op-4-接收用户请求ip信息"><span class="nav-number">5.8.5.</span> <span class="nav-text">⑤op &#x3D;4 接收用户请求ip信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#⑥接收到size-lt-0的消息"><span class="nav-number">5.8.6.</span> <span class="nav-text">⑥接收到size\&lt;&#x3D;0的消息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-系统整体说明书"><span class="nav-number">6.</span> <span class="nav-text">5.系统整体说明书</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1登陆界面"><span class="nav-number">6.1.</span> <span class="nav-text">5.1登陆界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2注册界面"><span class="nav-number">6.2.</span> <span class="nav-text">5.2注册界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3好友列表界面"><span class="nav-number">6.3.</span> <span class="nav-text">5.3好友列表界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4聊天界面"><span class="nav-number">6.4.</span> <span class="nav-text">5.4聊天界面</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-总结"><span class="nav-number">7.</span> <span class="nav-text">6.总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1遇到的问题及不足"><span class="nav-number">7.1.</span> <span class="nav-text">6.1遇到的问题及不足</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1遇到的问题"><span class="nav-number">7.1.1.</span> <span class="nav-text">6.1.1遇到的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2不足"><span class="nav-number">7.1.2.</span> <span class="nav-text">6.1.2不足</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2个人总结"><span class="nav-number">7.2.</span> <span class="nav-text">6.2个人总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-附录"><span class="nav-number">8.</span> <span class="nav-text">7.附录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1ping程序原理"><span class="nav-number">8.1.</span> <span class="nav-text">7.1ping程序原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2ping程序设计大体流程"><span class="nav-number">8.2.</span> <span class="nav-text">7.2ping程序设计大体流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3代码示例"><span class="nav-number">8.3.</span> <span class="nav-text">7.3代码示例</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="sdz"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">sdz</p>
  <div class="site-description" itemprop="description">个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/pxlsdz" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;pxlsdz" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/sdz20172133" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;sdz20172133" rel="noopener" target="_blank"><i class="fa fa-fw fa-codiepie"></i>CSDN</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sdz</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">300k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:33</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'pAM5gCGYUGBwBF62VmECeV0o-gzGzoHsz',
      appKey     : 'myehhFCNOsN4ClPFSLov1xKd',
      placeholder: "欢迎畅所欲言",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  <!-- 页面点击小红心 -->

      <script type="text/javascript" src="/js/clicklove.js"></script>

</body>
</html>
